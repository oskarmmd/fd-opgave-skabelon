---
import type { ImageMetadata } from "astro";
import { getImage } from "astro:assets";

const {
  imagePath,
  class: className = "",
  minHeight = "420px", // default
} = Astro.props;

const importedImage = `/src/assets/images/${imagePath}`;

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/*.{jpeg,jpg,png,gif,webp}"
);

if (!images[importedImage]) {
  throw new Error(`"${importedImage}" does not exist in glob`);
}

const optimizedBackground = await getImage({
  src: images[importedImage](),
  format: "webp",
});
---

<section
  class={className}
  style={`background-image:url(${optimizedBackground.src}); min-height:${minHeight};`}
>
  <slot />
</section>
